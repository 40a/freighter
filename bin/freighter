#!/usr/bin/env ruby

require 'optparse'
require 'bundler/setup'
require 'ostruct'
require 'freighter'
require 'pry'

@options = OpenStruct.new

if defined?(Rails)
  @options.config_path = "#{Rails.root}/config/freighter.yml" 
else
  @options.config_path = "./config/freighter.yml" 
end

OptionParser.new do |opts|
  opts.banner = "Usage: freigter [options] (deploy)"

  opts.on('-v', '--verbose', 'verbose logging') do |v|
    @options.verbose = true
  end

  opts.on('-c', '--config', 'path to yml config') do |opt|
    if opt
      @options.config_path = opt
    elsif defiend?(Rails) && Rails.root
      @options.config_path = "#{Rails.root}/config/freighter.yml"
    end
  end
end.parse!

logger = Freighter::Logger.new(@options)

logger.log "All hand on deck. Toot toot."
logger.log "app is chatty", :verbose

config = Freighter::Parse.new(@options)

case ARGV[0]
when "deploy"
  :deploy
else
  logger.log "unexpected command given: #{ARGV[0]}. See usage. freighter --help", :error
end

